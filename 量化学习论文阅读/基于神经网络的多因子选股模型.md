## 1.引用格式
 杨维. 基于神经网络的多因子选股模型[D]. 湖北:华中科技大学,2018. DOI:10.7666/d.D01542255.
## 具体研究内容：
建立合适的候选因子库，对数据进行去极值、缺失值处理、行业中性剔除，利用2010年1月到2012年12月的数据进行有效因子检验。
通过选定的评价指标，确定模型的训练窗口，然后分别构建动态 DNN、CNN、LSTM 神经网络模型，并对比分析三种深度学习神经网络的模型效果。
在三个阶段分别将神经网络模型和经典机器学习算法进行对比分析，比较模型在股票数据中的表现。
利用 DNN 模型的预测准确率的降序排序后，选取前 50 只股票作为目标池，每次先卖出账户中不在目标池的股票，每个月换仓一次后观察年化收益率、夏普比率等指标，评价选股模型的效果。
## 本文意义：
以机器学习的算法对股票进行分类，寻找A股市场中能获得超额收益的股票投资组合，从而可以在未来获得稳定收益。
## 相关理论介绍
### 量化投资：
是一种利用数学、统计学、计算科学及信息学等知识技术手段将投资对象进行量化分析实现精确投资的投资方法。量化投资最关键的技术是将机器学习和计算机的科学计算技术应用于宏观数据、企业相关的基本面财务数据、交易相关数据及市场行情等的数据的分析综合上面，期望利用上述的方法建立高收益的股票投资组合。量化投资有以下几个特点：
纪律性：所有决策都是通过模型进行不断测试而预测出来的，利用模型预测结果进行最终投资决策。

- 系统性：它是在多层次、多角度及多数据的基础上对市场信息的捕捉投资机会。
- 善于运用套利思想：投资机会来源于对错误估值及定价股票的挖掘
- 依靠概率大小获胜：通过对历史数据的分析，寻找规律加以运用，通过一组股票获得相应的投资来收益。

机器学习在量化投资方面的应用：量化择股（通过算法发现合适的股票投资组合）、量化择时（选择最佳买卖时间点）、算法交易（特定的买入卖出指令）以及市场分析等。
多因子选股模型
是一种以候选因子对收益率影响的标准作为标准的选股模型，它买入满足其候选因子标准的股票，卖出不满足标准的股票。
多因子模型的优点是：

- 通过一些方法综合有效因子库的各类信息从而选择出收益率较高的股票投资组合
- 不管在何种市场环境中，候选因子库总会有相应表现比较良好的因子对应于当前的市场环境，因此该模型具有稳健的选股能力。

本文选取的多因子模型是由Fame-French的三因子模型稍加变化而来，它将风格、行为、盈利、财务及风险等各方面因子都纳入候选因子库中，然后按照选股方法的不同选出有效因子组合。
神经网络的相关介绍
深度神经网络（DNN）
可以将DNN看成包含很多层隐藏层的变形感知机模型，深度神经网络的网络层与一般神经网络模型一样包括有输入、输出以及隐藏三层网络层。其基本结构如下：
![image.png](https://cdn.nlark.com/yuque/0/2021/png/22838017/1633603939664-399a1d67-ff70-4f07-945a-65cab7eb1fba.png#clientId=ub70109a2-8db8-4&from=paste&height=500&id=u7a7b28d4&originHeight=1000&originWidth=2403&originalType=binary&ratio=1&size=1296764&status=done&style=none&taskId=u36c2c292-1647-4e9b-9eeb-5b9466ef002&width=1201.5)
由结构图可以看出DNN中的层与层之间是属于完全连接的结构，即任意层的神经元与别的相连层的所有神经元都是相互连接的。
循环神经网络（RNN）
循环神经网络是一种引入了定向循环的神经网络，可以处理各输入相互关联的问题。一般的神经网络每层神经元是相互连接的，但是每一层的神经元之间是没有连接的。而RNN的每个序列会计算前一个输出的信息然后运用当前输出使其输出之前前后的关联。所以循环神经网络对时间序列数据的处理拥有很好的“记忆性”。RNN的网络结构图如下：
![image.png](https://cdn.nlark.com/yuque/0/2021/png/22838017/1633605138093-ec321eb2-4868-4ff1-b874-87e72ed13ce9.png#clientId=ub70109a2-8db8-4&from=paste&height=500&id=u08c2ee43&originHeight=1000&originWidth=2476&originalType=binary&ratio=1&size=514662&status=done&style=none&taskId=udff317db-9a65-4ccd-857d-3674035f8f5&width=1238)
图中每个圆圈代表一个单元，作用是一样的，也可以折叠成左图中半圆的样子，RNN的一个单元结构是重复使用的。RNN相对于传统神经网络最大优点是对于前一时刻信息具有“记忆性”。但是，随着距离的增加，RNN也会遇到从长期记忆退化到短期记忆的窘境，此外RNN也会面临梯度爆炸和梯度消失问题，故RNN难以处理长序列数据。
长短期记忆网络（LSTM）
长短期记忆网络（LSTM）是循环神经网络的一种特殊形式，能够学习长距离的一种相互依赖的关系，记住长距离的信息。相比于RNN的结构，可以看出LSTM的隐藏层比RNN复杂得多，它由四个网络层交互。下图是LSTM的隐藏层网路结构图
![image.png](https://cdn.nlark.com/yuque/0/2021/png/22838017/1633606166533-d78eaf2e-6232-4eb7-9197-9683b5c49570.png#clientId=ub70109a2-8db8-4&from=paste&height=500&id=u6e27f047&originHeight=1000&originWidth=2603&originalType=binary&ratio=1&size=1128136&status=done&style=none&taskId=ua872f004-e4b7-404b-8955-2549ddac454&width=1301.5)

图中最上面的一条线直接沿着整个链运行，进行简单的线性操作即可保持信息的不变性。除了最上面一条线，别的结构称为门控结构，这些结构可以对单元状态中的信息进行增加或者删除处理。门结构包括遗忘门、输入门和输出门。
卷积神经网络（CNN）
卷积神经网络是一种各层神经元之间不完全连接的特殊神经网络，而且对于同一层的一些神经元，其权重可能是相同的。由于卷积神经网络层与层之间的连接是局部的，因此CNN是用来识别二维形状而特殊设计的一种神经网络。由于本文只是将卷积神经网络用于对比其他的模型，因此没有做过多的原理介绍及算法推导。
#  2.论文解决的问题
本文主要是将机器学习的算法应用于多因子选股模型中，打破传统的基于打分以及回归等多因子选股模型思路，期望寻找一种基于神经网络的多因子分类选股方法，为多因子选股赋予一种不同的思维，同时扩展了机器学习在量化方面的应用方式。
# 3. 采用的思路、技术方法
## 3.1思路：
作者注意到神经网络可以适用比较复杂的数据关系，学习能力强，能够较好地模拟非线性映射，本文想要将神经网络应用于量化投资中的多因子选股中，一方面为多因子选股方法扩展了新的思路，同时也给别的机器学习方法运用于多因子选股提供想法。除此之外，本文考虑了多方面的候选因子，希望从中找到影响我国市场收益率的因子，然后基于这些因子建立神经网络选股模型。
## 3.2技术方法
### 3.2.1数据获取与处理
本文选取了A股2010年1月至2017年12月中每个月最后一个交易日的数据，其中2010年1月到2012年12月的数据用来对因子进行有效性检验，剩余作为样本外的检验回测分析。本文从多个方面考虑，最终纳入了34个候选因子。经过特征和标签提取、中位数去极值、缺失值处理、行业市值中性化、标准化等预处理步骤后，得到了有效样本。
### 3.2.2模型构建
首先选择训练窗口，本文选取12个月、24个月、36个月及48个月四种训练时间段的长度，建立动态学习模型。下图为不同训练窗口及模型的测试结果：
![image.png](https://cdn.nlark.com/yuque/0/2021/png/22838017/1637061162466-e96726a5-8799-403c-9db8-2225745b91ef.png#clientId=u3220d0fc-f596-4&from=paste&height=292&id=u3fac6290&originHeight=292&originWidth=792&originalType=binary&ratio=1&size=35200&status=done&style=none&taskId=u1e1bf8ea-75df-45f6-9209-8ff27d7be49&width=792)
可以看出N=36时，每个模型的AUC值都是最大的，所以最终确定模型的动态训练窗口为36个月。
神经网络的参数设置：隐藏层数为2，隐藏层单元为100，隐藏层激活函数选择Relu，输出层激活函数为sigmoid函数，dropout=0.2，学习速率为0.001，损失函数选择对数损失函数。
# 4. 解决的效果
## 4.1模型比较
本文选取三个阶段进行对比，对比指标为正确率、Recall率、AUC值。
第一阶段为2010-2012之间36个月的数据，结果如下：
![image.png](https://cdn.nlark.com/yuque/0/2021/png/22838017/1637062036289-67a10887-6060-4f55-b372-099a035dfecb.png#clientId=u3220d0fc-f596-4&from=paste&height=290&id=uc6af982e&originHeight=290&originWidth=770&originalType=binary&ratio=1&size=29861&status=done&style=none&taskId=ue1448e48-84da-4181-b82d-fcdc8557eeb&width=770)
由图可知DNN模型的预测效果是最好的，在机器学习算法中，SVM 表现最好，LR和NB可能不太适合用于在股票数据的预测上。
第三阶段比较结果如下：
![image.png](https://cdn.nlark.com/yuque/0/2021/png/22838017/1637062289977-2329a29a-8761-4a19-a3a0-3f01495af302.png#clientId=u3220d0fc-f596-4&from=paste&height=285&id=ue0ba497a&originHeight=285&originWidth=732&originalType=binary&ratio=1&size=27113&status=done&style=none&taskId=u206add37-8a64-42ca-88ce-669e1b8386f&width=732)
DNN模型还是优于其他模型，CNN和LSTM存在过拟合现象。
第五阶段比较结果如下：
![image.png](https://cdn.nlark.com/yuque/0/2021/png/22838017/1637062446576-dcaa3fd5-d947-499e-beca-6b1eca8ad75d.png#clientId=u3220d0fc-f596-4&from=paste&height=282&id=ufa21de65&originHeight=282&originWidth=732&originalType=binary&ratio=1&size=27570&status=done&style=none&taskId=u53b64d7c-60a8-4a35-a4d0-e9f981c1bca&width=732)
DNN在准确率和AUC的值都是最好的。
## 4.2模型实测换仓
通过以上比较，作者最终选用DNN进行回测，根据每个月月底预测出的下月收益标签为1或者0，按照准确率排序，前50只股票作为目标池，每次先卖出账户中不在目标池的股票，买入在目标池而不在账户中的股票，选定年化收益率、信息比率、夏普比率等指标评估模型效果。接着按照预测的1和0以及次级标签进行降序排序后，选择四个区间段建立动态调仓的股票组合，投资收益表如下：
![image.png](https://cdn.nlark.com/yuque/0/2021/png/22838017/1637063063887-98fd8d0f-5431-40c9-a5bb-fd0bea57b78e.png#clientId=u3220d0fc-f596-4&from=paste&height=212&id=u95b361e9&originHeight=212&originWidth=731&originalType=binary&ratio=1&size=30523&status=done&style=none&taskId=u6662026a-d5e0-463d-8005-fbe6320a622&width=731)
由图可知，从组1到组4，每个组内的年化收益率、夏普比率及年化超额收益率都是呈递减状态的，由此可知选股模型可以对A股市场上的强势股与弱势股有一定的区分度，从而在股票市场获得一定的超额收益率。
#  5.启示
本文首先以量化投资中的多因子选股为基本理论，期望从多因子选股的基础上 构建神经网络的选股模型。我们选择上市 A 股中的所有股票数据为样本，从不同大 类因子选择代表性小类因子构建候选因子库，经过预处理后检验候选因子库中的因子的有效性，剔除候选因子库中的无效因子后带入神经网络模型中进行预测，并与经典机器学习模型进行对比分析，最终以表现最好的 DNN 模型的预测结果进行回测调仓操作，期望构建能够获得稳定高收益的投资组合。 
本文选择的模型预测正确率并没有很高，因此对于参数选择方面还需要寻找更适合的方法选择最优参数，从而提高模型的预测准确率，除此之外，本文在进行回测换仓时，没有对比不同换仓月份的收益率以及行业内的分层回测。
#  6.有用的论点、句子
TP（True Positive）:实际类别是正向类别（Y=1），预测也为正类（Y=1）的样本总数。
FN（False Negative）：实际类别是正向类别（Y=1），预测也为负类（Y=0）的样本总数。 
FP（False Postitive）：实际类别是负向类别（Y=0），预测也为负类（Y=0）的样本总数。 
TN（True Negative）：实际类别是负向类别（Y=0），预测为正类（Y=1）的样本总数。
![image.png](https://cdn.nlark.com/yuque/0/2021/png/22838017/1637060436952-805d5de5-d00b-4fee-b754-eb6650f4596a.png#clientId=u3220d0fc-f596-4&from=paste&height=417&id=u02c908fb&originHeight=417&originWidth=756&originalType=binary&ratio=1&size=116135&status=done&style=none&taskId=ucc24d67f-c78c-4d8e-9daf-f56a4ae2088&width=756)
![image.png](https://cdn.nlark.com/yuque/0/2021/png/22838017/1637060447937-9ced0994-2038-4cfa-a4eb-f7a7bbd0e36e.png#clientId=u3220d0fc-f596-4&from=paste&height=421&id=uc165afa5&originHeight=421&originWidth=775&originalType=binary&ratio=1&size=108550&status=done&style=none&taskId=u6d867e54-af3f-4bb0-9211-50a10920772&width=775)

